<div class="product-detail min-vh-100">
  @if (product) {
    <div class="bg-light py-2">
      <div class="container">
        <nav aria-label="breadcrumb">
          <ol class="breadcrumb mb-0 small">
            <li class="breadcrumb-item">
              <a [routerLink]="['/']" class="text-decoration-none fw-medium">Inicio</a>
            </li>
            <li class="breadcrumb-item">
              <a [routerLink]="['/' + getCategoryPath(product.category)]" class="text-decoration-none fw-medium">
                {{ getCategoryName(product.category) }}
              </a>
            </li>
            <li class="breadcrumb-item active fw-semibold" aria-current="page">
              {{ product.name }}
            </li>
          </ol>
        </nav>
      </div>
    </div>
  }

  <div class="container py-3 py-md-4">
    <div class="row">
      <div class="col-lg-6 mb-3 mb-lg-0">
        <div class="product-images position-sticky" style="top: 80px;">
          @if (product) {
            <div class="main-image mb-2 text-center" style="padding: clamp(0.5rem, 2vw, 1rem);">
              <img [src]="currentImageUrl || getMainImage()" [alt]="product.name" class="img-fluid rounded-3"
                style="max-height: clamp(250px, 40vw, 400px); object-fit: contain;">
            </div>
          }
          @if (product && product.images && product.images.length > 1) {
            <div class="image-thumbnails d-flex gap-2 justify-content-center"
                 style="overflow-x: auto; overflow-y: hidden; -webkit-overflow-scrolling: touch; scrollbar-width: thin; scrollbar-color: #21372B #f0f0f0; padding-bottom: 0.5rem;">
              @for (img of product.images; track img.imageUrl; let i = $index) {
                <div class="thumbnail text-center position-relative"
                     (click)="selectImage(img.imageUrl)"
                     [class.active]="currentImageUrl === img.imageUrl"
                     style="flex: 0 0 auto; padding: clamp(0.2rem, 0.8vw, 0.4rem); cursor: pointer; transition: all 0.3s ease;">
                  <img [src]="img.imageUrl" [alt]="'Vista ' + (i + 1)" class="img-fluid rounded-2"
                    style="height: clamp(50px, 8vw, 70px); width: clamp(50px, 8vw, 70px); object-fit: cover; border: 2px solid transparent; transition: all 0.3s ease;"
                    [style.border-color]="currentImageUrl === img.imageUrl ? '#21372B' : 'transparent'"
                    [style.opacity]="currentImageUrl === img.imageUrl ? '1' : '0.6'">
                </div>
              }
            </div>
          }
        </div>
      </div>

      <div class="col-lg-6">
        @if (product) {
          <div class="product-info">
            <div class="mb-3">
              <h1 class="product-title mb-2" style="font-size: clamp(1.5rem, 3.5vw, 2rem); line-height: 1.2;">
                {{product.name}}</h1>
              <div class="badges d-flex gap-2">
                @if (product.isNew) {
                <span class="badge bg-success"
                  style="padding: 0.4rem 0.9rem; font-size: clamp(0.75rem, 1.1vw, 0.8rem); border-radius: 50px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);">Nuevo</span>
                }
                @if (product.isOnSale) {
                <span class="badge bg-danger"
                  style="padding: 0.4rem 0.9rem; font-size: clamp(0.75rem, 1.1vw, 0.8rem); border-radius: 50px; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);">Oferta</span>
                }
              </div>
            </div>

            @if (product) {
              <div class="product-price mb-3 rounded-4 shadow-sm border border-2" 
                style="padding: clamp(0.8rem, 1.5vw, 1.2rem);">
                @if (product.originalPrice && product.originalPrice > product.price) {
                <div class="d-flex align-items-center gap-2 flex-wrap">
                  <span class="original-price text-decoration-line-through text-muted"
                    style="font-size: clamp(1rem, 1.8vw, 1.2rem);">
                    {{ product.originalPrice | currency:'COP':'symbol-narrow':'1.0-0':'es-CO' }}
                  </span>
                  <span class="current-price" style="font-size: clamp(1.75rem, 3.5vw, 2.2rem);">
                    {{ product.price | currency:'COP':'symbol-narrow':'1.0-0':'es-CO' }}
                  </span>
                  @if (product.discount && product.discount > 0) {
                    <span class="discount-badge"
                      style="padding: 0.35rem 0.7rem; border-radius: 50px; font-size: clamp(0.75rem, 1.1vw, 0.85rem);">
                      -{{ product.discount }}%
                    </span>
                  }
                </div>
                } @else {
                <span class="current-price" style="font-size: clamp(1.75rem, 3.5vw, 2.2rem);">{{ product.price | currency:'COP':'symbol-narrow':'1.0-0':'es-CO' }}</span>
                }
              </div>
            }

            <div class="product-description mb-3">
              <h5 class="fw-bold mb-2 position-relative pb-2" style="font-size: clamp(1rem, 1.8vw, 1.2rem);">Descripción
              </h5>
              <p class="text-muted lh-base mb-0" style="font-size: clamp(0.9rem, 1.4vw, 1rem);">{{product.description}}
              </p>
            </div>

            <div class="product-features mb-3">
              <h5 class="fw-bold mb-2 position-relative pb-2" style="font-size: clamp(1rem, 1.8vw, 1.2rem);">
                Características</h5>
              @if (getFeatures().length > 0) {
                <ul class="features-list list-unstyled m-0">
                  @for (feature of getFeatures(); track feature) {
                    <li class="p-2 mb-2 rounded-3 fw-medium"
                        style="font-size: clamp(0.85rem, 1.3vw, 0.95rem);">
                      <!-- <i class="bi bi-check-circle-fill text-success me-2"></i> -->
                      {{ feature }}
                    </li>
                  }
                </ul>
              } @else {
                <p class="text-muted fst-italic" style="font-size: clamp(0.85rem, 1.3vw, 0.95rem);">
                  No hay características especificadas para este producto.
                </p>
              }
            </div>

            <div class="product-actions mt-3">
              <div class="d-grid gap-2 d-md-flex">
                <button class="btn btn-primary btn-lg position-relative overflow-hidden border-0" (click)="processPayment()"
                  style="padding: clamp(0.8rem, 1.5vw, 1rem); font-size: clamp(0.9rem, 1.3vw, 1rem); border-radius: 50px; min-width: 180px; box-shadow: 0 8px 20px rgba(33, 55, 43, 0.3);">
                  <i class="bi bi-credit-card me-2"></i>
                  Pagar Ahora
                </button>
                <a href="https://wa.me/tunumero" class="btn btn-success btn-lg position-relative overflow-hidden border-0"
                  target="_blank" rel="noopener noreferrer"
                  style="padding: clamp(0.8rem, 1.5vw, 1rem); font-size: clamp(0.9rem, 1.3vw, 1rem); border-radius: 50px; min-width: 180px; box-shadow: 0 8px 20px rgba(37, 211, 102, 0.3);">
                  <i class="bi bi-whatsapp me-2"
                    style="font-size: clamp(1rem, 1.8vw, 1.2rem); vertical-align: middle;"></i>
                  Consultar por WhatsApp
                </a>
              </div>
            </div>
          </div>
        }
      </div>
    </div>
  </div>
</div>
